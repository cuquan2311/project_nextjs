// ğŸ” GIáº¢I THÃCH: Táº¡i sao {children} váº«n lÃ  Server Component

// âœ… HIá»‚U ÄÃšNG: React Element Tree vs Component Tree

// 1. Server Component render trÆ°á»›c
// app/layout.tsx (Server Component)
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <ThemeProviders>
          {/* 
            QUAN TRá»ŒNG: {children} á»Ÿ Ä‘Ã¢y KHÃ”NG PHáº¢I lÃ  component call!
            NÃ³ lÃ  React Element Ä‘Ã£ Ä‘Æ°á»£c render trÃªn server
          */}
          {children}
        </ThemeProviders>
      </body>
    </html>
  )
}

// 2. Server Component con
// app/page.tsx (Server Component) 
export default function HomePage() {
  console.log('ğŸ–¥ï¸ Server: This runs on server only!')
  
  return (
    <Container>
      <Typography>Server rendered content</Typography>
      <ServerData />
    </Container>
  )
}

// 3. Client Component wrapper
// components/ThemeProviders.tsx (Client Component)
'use client'
export function ThemeProviders({ children }: { children: React.ReactNode }) {
  console.log('ğŸŒ Client: This runs on client!')
  
  return (
    <NextThemeProvider>
      <MuiThemeWrapper>
        {/* 
          children á»Ÿ Ä‘Ã¢y lÃ  React Element tree Ä‘Ã£ render,
          KHÃ”NG PHáº¢I lÃ  component function calls!
        */}
        {children}
      </MuiThemeWrapper>
    </NextThemeProvider>
  )
}

// ğŸ§  VISUALIZATION: Render Process

/*
BÆ¯á»šC 1: Server render
===================
HomePage() Ä‘Æ°á»£c gá»i trÃªn server â†’ táº¡o ra React Element tree:
{
  type: Container,
  props: { 
    children: {
      type: Typography,
      props: { children: "Server rendered content" }
    }
  }
}

BÆ¯á»šC 2: Serialization  
====================
React Element tree Ä‘Æ°á»£c serialize thÃ nh JSX/HTML

BÆ¯á»šC 3: Client hydration
========================
ThemeProviders nháº­n children lÃ  cÃ¡i React Element tree Ä‘Ã£ serialize,
KHÃ”NG pháº£i function calls!
*/

// ğŸ”¬ DEMO: Chá»©ng minh vá»›i logging

// Server Component
export default function ServerPage() {
  console.log('ğŸ–¥ï¸ SERVER: HomePage render', new Date()) // Chá»‰ cháº¡y trÃªn server
  
  return (
    <div>
      <h1>Server Content</h1>
      <ServerComponent />
      <ClientWrapper>
        <AnotherServerComponent />
      </ClientWrapper>
    </div>
  )
}

// Server Component con
function ServerComponent() {
  console.log('ğŸ–¥ï¸ SERVER: ServerComponent render') // Chá»‰ cháº¡y trÃªn server
  return <p>I am server rendered</p>
}

// Client Component wrapper
'use client'
function ClientWrapper({ children }: { children: React.ReactNode }) {
  console.log('ğŸŒ CLIENT: ClientWrapper render') // Cháº¡y trÃªn client
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
      {/* children nÃ y Ä‘Ã£ render trÃªn server! */}
      {children}
    </div>
  )
}

// Server Component khÃ¡c
function AnotherServerComponent() {
  console.log('ğŸ–¥ï¸ SERVER: AnotherServerComponent render') // Chá»‰ cháº¡y trÃªn server
  return <p>I am also server rendered!</p>
}

// ğŸ“Š CONSOLE OUTPUT:
/*
Server Console:
ğŸ–¥ï¸ SERVER: HomePage render
ğŸ–¥ï¸ SERVER: ServerComponent render  
ğŸ–¥ï¸ SERVER: AnotherServerComponent render

Client Console:
ğŸŒ CLIENT: ClientWrapper render
*/

// ğŸ¯ KEY CONCEPTS

// âŒ SAI HIá»‚U: NghÄ© ráº±ng children Ä‘Æ°á»£c "gá»i" trong Client Component
'use client'
function WrongThinking({ children }) {
  // NgÆ°á»i ta nghÄ© children() Ä‘Æ°á»£c gá»i á»Ÿ Ä‘Ã¢y â†’ thÃ nh Client Component
  return <div>{children}</div>
}

// âœ… ÄÃšNG: children lÃ  React Element tree Ä‘Ã£ render
'use client' 
function CorrectUnderstanding({ children }: { children: React.ReactNode }) {
  // children á»Ÿ Ä‘Ã¢y lÃ  JSX elements Ä‘Ã£ Ä‘Æ°á»£c render trÃªn server
  // KhÃ´ng cÃ³ function call nÃ o xáº£y ra!
  return <div>{children}</div>
}

// ğŸ”§ TECHNICAL DETAILS

/*
1. REACT ELEMENT vs REACT COMPONENT:
   - Component: function HomePage() { ... } â†’ cháº¡y trÃªn server
   - Element: <HomePage /> hoáº·c React.createElement() â†’ data structure

2. CHILDREN TRONG PROPS:
   - children khÃ´ng pháº£i function call
   - children lÃ  React Element tree (data)
   - Element tree nÃ y Ä‘Ã£ render trÃªn server

3. HYDRATION PROCESS:
   - Server gá»­i HTML + serialized element tree
   - Client nháº­n element tree, khÃ´ng re-render Server Components
   - Client chá»‰ hydrate Client Components
*/

// ğŸ§ª EXPERIMENT: Kiá»ƒm tra vá»›i component lifecycle

// Server Component vá»›i side effects
export default function ExperimentPage() {
  // Side effect chá»‰ cháº¡y trÃªn server
  const timestamp = new Date().toISOString()
  console.log('ğŸ–¥ï¸ SERVER ONLY:', timestamp)
  
  return (
    <ClientBoundary>
      <ServerChild timestamp={timestamp} />
    </ClientBoundary>
  )
}

// Client Component boundary
'use client'
function ClientBoundary({ children }: { children: React.ReactNode }) {
  const [mounted, setMounted] = useState(false)
  
  useEffect(() => {
    setMounted(true)
    console.log('ğŸŒ CLIENT: Boundary mounted')
  }, [])
  
  return (
    <div>
      <p>Client boundary (mounted: {String(mounted)})</p>
      {/* children Ä‘Ã£ render vá»›i timestamp tá»« server */}
      {children}
    </div>
  )
}

// Server Component con
function ServerChild({ timestamp }: { timestamp: string }) {
  console.log('ğŸ–¥ï¸ SERVER: ServerChild render with:', timestamp)
  
  return (
    <div>
      <p>Server timestamp: {timestamp}</p>
      <p>This timestamp never changes on client interactions!</p>
    </div>
  )
}

// ğŸª REAL-WORLD EXAMPLE: Theme Provider

// Layout (Server)
export default function Layout({ children }) {
  return (
    <html>
      <body>
        {/* 
          Táº¥t cáº£ page components render trÃªn server trÆ°á»›c,
          táº¡o thÃ nh element tree, rá»“i má»›i pass vÃ o ThemeProvider
        */}
        <ThemeProvider>{children}</ThemeProvider>
      </body>
    </html>
  )
}

// Theme Provider (Client)  
'use client'
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light')
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <div className={theme}>
        {/* 
          children á»Ÿ Ä‘Ã¢y lÃ  element tree Ä‘Ã£ render trÃªn server:
          - KhÃ´ng cÃ³ re-render khi theme change
          - Chá»‰ CSS class thay Ä‘á»•i
          - Performance cao vÃ¬ khÃ´ng re-execute server logic
        */}
        {children}
      </div>
    </ThemeContext.Provider>
  )
}

// ğŸ“ SUMMARY

/*
Táº I SAO {children} VáºªN LÃ€ SERVER COMPONENT:

1. âœ… Composition over Re-rendering
   - children lÃ  data (React Elements), khÃ´ng pháº£i function calls
   - Server Components render thÃ nh elements trÆ°á»›c khi pass xuá»‘ng

2. âœ… Serialization Boundary
   - React serialize server-rendered elements
   - Client nháº­n serialized data, khÃ´ng re-render

3. âœ… Performance Optimization  
   - TrÃ¡nh re-render unnecessary code trÃªn client
   - Giá»¯ Ä‘Æ°á»£c server-side optimizations (caching, data fetching)

4. âœ… Architecture Benefits
   - Clear separation between server vÃ  client logic
   - Minimal JavaScript bundle
   - Better Core Web Vitals
*/